<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ event[1] if event else 'Event Details' }} - Ticketmeister</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header id="header">
        <a href="{{ url_for('home') }}" class="logo-link">
            <div class="logo">Ticketmeister</div>
        </a>
        <nav>
            <a href="{{ url_for('home') }}">Home</a>
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('profile') }}">Profile</a>
                <a href="{{ url_for('logout') }}">Logout</a>
            {% else %}
                <a href="{{ url_for('login') }}">Login</a>
                <a href="{{ url_for('register') }}">Register</a>
            {% endif %}
        </nav>
    </header>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash {{ category }}">
                        {{ message }}
                        <button onclick="this.parentElement.remove()">√ó</button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    {% if event %}
    <div class="event-detail-hero" style="background: linear-gradient(to bottom, rgba(0,0,0,0.5), rgba(20,20,20,1)), url('/static/img/hero1.jpg'); background-size: cover;">
        <div class="event-detail-content">
            <h1>{{ event[1] }}</h1>
            <div class="event-meta">
                <span>üìÖ {{ event[3].strftime('%A, %B %d, %Y at %I:%M %p') if event[3] else 'Date TBA' }}</span>
                <span>üìç {{ event[5] }}, {{ event[7] }}, {{ event[8] }}</span>
                {% if event[10] %}
                    <span>üéµ {{ event[10] }}</span>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="event-detail-container">
        <div class="event-detail-main">
            <div class="event-section">
                <h2>About This Event</h2>
                <p>{{ event[2] or 'Get ready for an incredible live experience! This concert promises to be one of the most memorable performances of the year.' }}</p>
            </div>

            {% if performers %}
            <div class="event-section">
                <h2>Performers</h2>
                <div class="performers-list">
                    {% for performer in performers %}
                    <div class="performer-item">
                        <div class="performer-name">
                            {{ performer[2] or (performer[0] + ' ' + performer[1]) }}
                        </div>
                        {% if performer[3] %}
                        <span class="headliner-badge">HEADLINER</span>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <div class="event-section">
                <h2>Venue Information</h2>
                <div class="venue-info">
                    <h3>{{ event[5] }}</h3>
                    <p>{{ event[6] }}</p>
                    <p>{{ event[7] }}, {{ event[8] }}</p>
                    {% if event[9] %}
                        <p>Capacity: {{ event[9] }} people</p>
                    {% endif %}
                    {% if event[11] %}
                        <p class="outdoor-badge">üå§Ô∏è Outdoor Event</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="event-detail-sidebar">
            <div class="ticket-selection-box">
                <h2>Select Your Tickets</h2>
                
                {% if not current_user.is_authenticated %}
                    <div class="login-prompt">
                        <p>Please log in to purchase tickets</p>
                        <a href="{{ url_for('login', next=request.path) }}" class="btn btn-primary full-width">Log In</a>
                    </div>
                {% elif tickets %}
                <form method="POST" action="{{ url_for('select_tickets', event_id=event[0]) }}" id="ticketForm">
                    <div class="ticket-options">
                        {% set ns = namespace(regular_shown=false, vip_shown=false) %}
                        {% for ticket in tickets %}
                            {% if ticket[6] == 'Regular' and not ns.regular_shown %}
                                {% set ns.regular_shown = true %}
                                <div class="ticket-option">
                                    <label>
                                        <input type="checkbox" name="tickets[]" value="{{ ticket[0] }}" onchange="updateTotal()">
                                        <div class="ticket-info">
                                            <span class="ticket-type">General Admission</span>
                                            <span class="ticket-details">
                                                {% if ticket[3] %}
                                                    Section {{ ticket[3] }}, Row {{ ticket[4] }}, Seat {{ ticket[5] }}
                                                {% else %}
                                                    Standing room
                                                {% endif %}
                                            </span>
                                        </div>
                                        <div class="ticket-price">{{ ticket[2] }}{{ "%.0f"|format(ticket[1]) }}</div>
                                    </label>
                                </div>
                            {% elif ticket[6] == 'VIP' and not ns.vip_shown %}
                                {% set ns.vip_shown = true %}
                                <div class="ticket-option">
                                    <label>
                                        <input type="checkbox" name="tickets[]" value="{{ ticket[0] }}" onchange="updateTotal()">
                                        <div class="ticket-info">
                                            <span class="ticket-type">VIP Package - {{ ticket[7] or 'Premium' }}</span>
                                            <span class="ticket-details">
                                                {{ ticket[8] or 'Premium seating and benefits' }}
                                            </span>
                                        </div>
                                        <div class="ticket-price">{{ ticket[2] }}{{ "%.0f"|format(ticket[1]) }}</div>
                                    </label>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                    
                    <div class="ticket-total">
                        <span>Total:</span>
                        <span id="totalAmount">‚Ç¨0</span>
                    </div>
                    
                    <button type="submit" class="btn btn-primary full-width">Proceed to Checkout</button>
                </form>
                {% else %}
                    <p class="no-tickets">Sorry, no tickets available for this event.</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <footer class="imprint_footer">
        <div class="imprint-content">
            <h3><a href="{{ url_for('imprint')}}" class="imprint-link">Imprint</a></h3>
        </div>
    </footer>

    <script>
        function updateTotal() {
            const checkboxes = document.querySelectorAll('input[name="tickets[]"]:checked');
            let total = 0;
            
            checkboxes.forEach(checkbox => {
                const priceElement = checkbox.closest('.ticket-option').querySelector('.ticket-price');
                const priceText = priceElement.textContent.replace(/[^0-9.]/g, '');
                total += parseFloat(priceText) || 0;
            });
            
            document.getElementById('totalAmount').textContent = '‚Ç¨' + total.toFixed(0);
        }
    </script>
</body>
</html>

