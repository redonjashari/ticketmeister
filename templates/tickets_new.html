{% extends "base.html" %}
{% block title %}Create Ticket · TicketMeister{% endblock %}
{% block content %}
<section class="page-shell">
  <header class="page-header">
    <h1>Create Ticket</h1>
    <p>Define inventory and pricing for an event, with optional seat assignments and availability states.</p>
  </header>
  <form class="form-card" method="post" action="{{ url_for('tickets_create') }}">
    <div class="form-grid">
      <label class="form-field">
        <span class="form-label">Event</span>
        <select name="event_id" required>
          {% for e in events %}
          <option value="{{ e[0] }}">{{ e[1] }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="form-field">
        <span class="form-label">Ticket Type</span>
        <select name="ticket_type" id="ticket_type" required onchange="updateTicketFields()">
          <option value="general">General Admission</option>
          <option value="seat">Seat Ticket</option>
          <option value="vip">VIP Ticket</option>
        </select>
      </label>
      <label class="form-field" id="seat_field" style="display: none;">
        <span class="form-label">Seat</span>
        <select name="seat_id">
          <option value="">-- select seat --</option>
          {% for s in seats %}
          <option value="{{ s[0] }}">{{ s[1] }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="form-field">
        <span class="form-label">Face value (€)</span>
        <input type="number" step="0.01" min="0" name="face_value" required placeholder="59.00">
      </label>
      <label class="form-field">
        <span class="form-label">Currency</span>
        <input name="currency" value="EUR">
      </label>
      <label class="form-field">
        <span class="form-label">Status</span>
        <select name="ticket_status">
          <option>available</option>
          <option>reserved</option>
          <option>sold</option>
          <option>cancelled</option>
        </select>
      </label>
      <label class="form-field">
        <span class="form-label">Issued at</span>
        <input type="datetime-local" name="issued_at">
      </label>
      <label class="form-field" id="vip_level_field" style="display: none;">
        <span class="form-label">VIP Level</span>
        <select name="vip_level">
          <option value="Gold">Gold</option>
          <option value="Platinum">Platinum</option>
          <option value="Diamond">Diamond</option>
        </select>
      </label>
      <label class="form-field field-span" id="vip_perks_field" style="display: none;">
        <span class="form-label">VIP Perks</span>
        <textarea name="vip_perks" placeholder="Meet & Greet, Backstage Pass, Priority Entry"></textarea>
      </label>
      <label class="form-field" id="lounge_access_field" style="display: none;">
        <span class="form-label">Lounge Access</span>
        <select name="lounge_access">
          <option value="1">Yes</option>
          <option value="0">No</option>
        </select>
      </label>
      <label class="form-field" id="refundable_field" style="display: none;">
        <span class="form-label">Refundable</span>
        <select name="refundable">
          <option value="1">Yes</option>
          <option value="0">No</option>
        </select>
      </label>
      <label class="form-field" id="refund_deadline_field" style="display: none;">
        <span class="form-label">Refund Deadline</span>
        <input type="datetime-local" name="refund_deadline">
      </label>
    </div>
    <div class="form-actions">
      <button class="primary-button" type="submit">Create Ticket</button>
    </div>
  </form>
</section>

<script>
function updateTicketFields() {
  const ticketType = document.getElementById('ticket_type').value;
  const seatField = document.getElementById('seat_field');
  const vipLevelField = document.getElementById('vip_level_field');
  const vipPerksField = document.getElementById('vip_perks_field');
  const loungeAccessField = document.getElementById('lounge_access_field');
  const refundableField = document.getElementById('refundable_field');
  const refundDeadlineField = document.getElementById('refund_deadline_field');
  
  // Hide all optional fields
  seatField.style.display = 'none';
  vipLevelField.style.display = 'none';
  vipPerksField.style.display = 'none';
  loungeAccessField.style.display = 'none';
  refundableField.style.display = 'none';
  refundDeadlineField.style.display = 'none';
  
  if (ticketType === 'seat') {
    seatField.style.display = 'block';
    refundableField.style.display = 'block';
    refundDeadlineField.style.display = 'block';
  } else if (ticketType === 'vip') {
    seatField.style.display = 'block';
    vipLevelField.style.display = 'block';
    vipPerksField.style.display = 'block';
    loungeAccessField.style.display = 'block';
  } else if (ticketType === 'general') {
    refundableField.style.display = 'block';
    refundDeadlineField.style.display = 'block';
  }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', updateTicketFields);
</script>
{% endblock %}
